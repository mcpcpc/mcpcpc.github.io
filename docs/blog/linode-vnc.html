<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<title>Linode and VNC &mdash; minimum viable solutions written in C</title>
		<meta name="description" content="Minimum viable C programming solutions">
		<meta name="viewport" content="width=device-width">
		<meta property="og:type" content="website">
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
		<link rel="apple-touch-icon" href="apple-touch-icon.png">
		<style>
			body {
				font-family: Liberation Sans, Arial, sans-serif;
				line-height: 1.5;
			}

			main {
				max-width: 70ch;
				padding: 2ch;
				margin: auto;
			}

			h1 {
				margin-bottom: 2rem;
			}

			hr {
				margin-top: 2rem;
			}

			a, a:hover {
				text-decoration: underline;
			}

			table {
				width: 100%;
			}

			td {
				text-align: center;
			}
	</style>
	</head>
	<body>
		<main>
<h1 id="Linode%20and%20VNC">Linode and VNC</h1>

<p>As part of my recent efforts to expand <a href="http://github.com/mcpcpc/xwm">xwm</a> to 
various distribution platforms, I decided to purchase a Linode virtual machine
(VM). The sole purpose of this compute module is to host Docker and various 
operating system containers (e.g. Debian, CentOS, Arch Linux, Void Linux, etc). 
I opted for the bottom-line 5 USD shared which, while only having 1GB of RAM 
and 1 Core, is surprisingly fast and made pushing cross-platform package updates
a breeze. </p>

<p>At some point I decided that it would be a good idea to run GUI-based 
applications on my shiny new VM. The process for getting a minimal Xorg server up
and running was fairly straight forward.  I did, however, encounter a few &#8220;snags&#8221; 
that I figured would be worth sharing. Also, if it any point I decide to repeat
this process on a different VM, I at least won&#39;t waste any time figuring out 
what went wrong.  </p>

<h2 id="Xorg%20Server">Xorg Server</h2>

<p>To start, let&#39;s make sure that we are SSH&#39;d in and logged in as a regular user 
(a.k.a non-root). This regular user should (1) be part of the sudoers group and 
(2) be a member of the audio and video groups. If you are not sure which groups 
your regular user belongs to, you can always confirm with the <code>groups</code> command. 
If you are missing a group you can add one or multiple with the following 
command, replacing &#60;username&#62; with your regular user name:</p>

<pre><code class="language-shell">usermod -a -G audio &#60;username&#62;
usermod -a -G video &#60;username&#62;
</code></pre>

<p>We then need to verify that we have all of the prequisit packages installed. Note
that I specify <code>xwm</code> in the application list below, but this will also work with
many other window managers (e.g. cwm, dwm, evilwm, etc.):</p>

<pre><code class="language-shell">sudo apt update
sudo apt upgrade
sudo apt install xinit x11vnc xwm
</code></pre>

<p>With all of the prerequisit packages installed, we need to tell xorg which window
manager to run when starting the server. For this, we will create an <code>.xinitrc</code> 
file in the regular user&#39;s HOME directory: </p>

<pre><code class="language-shell">echo "exec xwm" &#62; ~&#47;.xinitrc
</code></pre>

<p>At this point, we are almost there. We could try to start the Xorg server as a 
regular user, but the server will most likely complain and throw off multiple 
errors. To fix these errors, we need to to change some of the server&#39;s default
permissions. Begin by opening the Xwrapper.config file for editting:</p>

<pre><code class="language-shell">sudo vim &#47;etc&#47;X11&#47;Xwrapper.config
</code></pre>

<p>Once opened, change the <code>allowed_users=</code> value from &#8220;console&#8221; to &#8220;anybody&#8221;. This
will allow a regular user from a non-TTY (e.g. over SSH) to start the Xorg 
server. Once changed, you&#39;r config file should like something like the one
below:</p>

<pre><code>an X Window System server wrapper configuration file)
#
# This file was generated by the post-installation script of the
# xserver-xorg-legacy package using values from the debconf database.
#
# See the Xwrapper.config(5) manual page for more information.
#
# This file is automatically updated on upgrades of the xserver-xorg-legacy
# package *only* if it has not been modified since the last upgrade of that
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command as root:
#   dpkg-reconfigure xserver-xorg-legacy
#allowed_users=console
allowed_users=anybody
needs_root_rights=yes
</code></pre>

<p>Remember to save and close the modified Xwrapper.config file mentioned above. At 
this point we, can test the Xorg server:</p>

<pre><code class="language-shell">startx
</code></pre>

<p>If all goes well, the server should start right away.  If it fails, inspect the 
log file, typically located in the ~&#47;.local&#47;share&#47;xorg&#47; directory. If it starts
succesfully, we can force it to shutdown with Ctrl+C and proceed to the next
step of configuring x11vnc.</p>

<h2 id="x11vnc">x11vnc</h2>
		</main>
		<footer>
		</footer>
	</body>
</html>
