---
layout: post
title: "Linode and VNC"
---

As part of my recent efforts to expand [xwm](http://github.com/mcpcpc/xwm) to 
various distribution platforms, I decided to purchase a Linode virtual machine
(VM). The sole purpose of this compute module is to host Docker and various 
operating system containers (e.g. Debian, CentOS, Arch Linux, Void Linux, etc). 
I opted for the bottom-line 5 USD shared which, while only having 1GB of RAM 
and 1 Core, is surprisingly fast and made pushing cross-platform package updates
a breeze. 

At some point I decided that it would be a good idea to run GUI-based 
applications on my shiny new VM. The process for getting a minimal Xorg server up
and running was fairly straight forward.  I did, however, encounter a few "snags" 
that I figured would be worth sharing. Also, if it any point I decide to repeat
this process on a different VM, I at least won't waste any time figuring out 
what went wrong.  

## Xorg Server

To start, let's make sure that we are SSH'd in and logged in as a regular user 
(a.k.a non-root). This regular user should (1) be part of the sudoers group and 
(2) be a member of the audio and video groups. If you are not sure which groups 
your regular user belongs to, you can always confirm with the `groups` command. 
If you are missing a group you can add one or multiple with the following 
command, replacing <username> with your regular user name:

```shell
usermod -a -G audio <username>
usermod -a -G video <username>
```

We then need to verify that we have all of the prequisit packages installed. Note
that I specify `xwm` in the application list below, but this will also work with
many other window managers (e.g. cwm, dwm, evilwm, etc.):

```shell
sudo apt update
sudo apt upgrade
sudo apt install xinit x11vnc xwm
```

With all of the prerequisit packages installed, we need to tell xorg which window
manager to run when starting the server. For this, we will create an `.xinitrc` 
file in the regular user's HOME directory: 

```shell
echo "exec xwm" > ~/.xinitrc
```

At this point, we are almost there. We could try to start the Xorg server as a 
regular user, but the server will most likely complain and throw off multiple 
errors. To fix these errors, we need to to change some of the server's default
permissions. Begin by opening the Xwrapper.config file for editting:

```shell
sudo vim /etc/X11/Xwrapper.config
```

Once opened, change the `allowed_users=` value from "console" to "anybody". This
will allow a regular user from a non-TTY (e.g. over SSH) to start the Xorg 
server. Once changed, you'r config file should like something like the one
below:

```
an X Window System server wrapper configuration file)
#
# This file was generated by the post-installation script of the
# xserver-xorg-legacy package using values from the debconf database.
#
# See the Xwrapper.config(5) manual page for more information.
#
# This file is automatically updated on upgrades of the xserver-xorg-legacy
# package *only* if it has not been modified since the last upgrade of that
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command as root:
#   dpkg-reconfigure xserver-xorg-legacy
#allowed_users=console
allowed_users=anybody
needs_root_rights=yes
```

Remember to save and close the modified Xwrapper.config file mentioned above. At 
this point we, can test the Xorg server:

```shell
startx
```

If all goes well, the server should start right away.  If it fails, inspect the 
log file, typically located in the ~/.local/share/xorg/ directory. If it starts
succesfully, we can force it to shutdown with Ctrl+C and proceed to the next
step of configuring x11vnc.

## x11vnc

